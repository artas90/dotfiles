#!/usr/bin/env -S deno run -A

function main() {
  const data = JSON.parse(Deno.readTextFileSync(".vscode/settings.json"));
  const exclude = data['files.exclude'] ?? {}

  for (const dirEntry of Deno.readDirSync('.')) {
    if (dirEntry.isDirectory && dirEntry.name !== '.vscode') {
      const key = dirEntry.name + '/';
      exclude[key] ??= false;
    }
  }

  const ordered = Object.keys(exclude).sort().reduce(
    (obj, key) => (obj[key] = exclude[key], obj), {}
  );
  data['files.exclude'] = ordered;

  Deno.writeTextFileSync(".vscode/settings.json", JSON.stringify(data, null, 2));
}

main()
